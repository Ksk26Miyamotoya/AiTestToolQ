# トラブルシューティング

このドキュメントでは、Basic認証サイト同時アクセステストツールを使用する際に発生する可能性のある一般的な問題と、その解決方法について説明します。より詳細な質問と回答については、[FAQ](faq.md)も参照してください。

## インストール関連の問題

### WebDriverが見つからない

**症状**: 以下のようなエラーメッセージが表示される
```
WebDriverException: 'chromedriver' executable needs to be in PATH
```

**解決策**:
1. ChromeDriverが正しくインストールされていることを確認します
2. ChromeDriverのパスがシステムのPATHに含まれていることを確認します
3. ChromeDriverのバージョンがChromeのバージョンと一致していることを確認します

**詳細な手順**:
```bash
# ChromeDriverのバージョンを確認
chromedriver --version

# Chromeのバージョンを確認
google-chrome --version  # Linux
# または
"/Applications/Google Chrome.app/Contents/MacOS/Google Chrome" --version  # macOS
# または
reg query "HKEY_CURRENT_USER\Software\Google\Chrome\BLBeacon" /v version  # Windows
```

### Seleniumのバージョンの問題

**症状**: 以下のようなエラーメッセージが表示される
```
AttributeError: 'WebDriver' object has no attribute 'find_element_by_*'
```

**解決策**:
- Seleniumの最新バージョンをインストールします
```bash
pip install --upgrade selenium
```

## 設定関連の問題

### 設定ファイルが見つからない

**症状**: 以下のようなエラーメッセージが表示される
```
FileNotFoundError: 設定ファイル 'resources/config.json' が見つかりません
```

**解決策**:
1. `resources` ディレクトリが存在することを確認します
2. `resources/config.json` ファイルが存在することを確認します
3. 正しいパスを指定していることを確認します

**詳細な手順**:
```bash
# ディレクトリ構造を確認
ls -la

# resources ディレクトリが存在しない場合は作成
mkdir -p resources

# 設定ファイルのテンプレートをコピー
cp path/to/template/config.json resources/config.json
```

### シナリオファイルが見つからない

**症状**: 以下のようなエラーメッセージが表示される
```
FileNotFoundError: シナリオファイル 'resources/test_scenario.csv' が見つかりません
```

**解決策**:
1. `resources` ディレクトリが存在することを確認します
2. `resources/test_scenario.csv` ファイルが存在することを確認します
3. 設定ファイルで正しいシナリオファイルのパスを指定していることを確認します

## 実行時の問題

### Basic認証の問題

**症状**: Basic認証が失敗し、401 Unauthorizedエラーが発生する

**解決策**:
1. 設定ファイルのユーザー名とパスワードが正しいことを確認します
2. URLの形式が正しいことを確認します
3. Basic認証情報がURLに正しく埋め込まれていることを確認します

**デバッグ方法**:
- テストモードで実行し、ブラウザの動作を確認します
```bash
python -m src --test-mode
```

### 要素が見つからない

**症状**: 以下のようなエラーメッセージが表示される
```
要素が見つかりません: #login-button
```

**解決策**:
1. セレクタが正しいことを確認します
2. 要素が表示されるまでの待機時間を増やします
3. フレームやiframeの中に要素がある場合は、フレーム切替操作を追加します
4. 動的に生成される要素の場合、要素が操作可能になるまで待機する操作を追加します

**デバッグ方法**:
- テストモードで実行し、要素が実際に存在するかを確認します
- ブラウザの開発者ツールを使用して、正しいセレクタを特定します

### クリック操作が失敗する

**症状**: クリック操作が失敗し、要素がクリックされない

**解決策**:
1. 要素が画面に表示されていることを確認します（スクロールが必要な場合があります）
2. 要素が他の要素に隠れていないことを確認します
3. 強制クリック操作を使用します

**修正例**:
```csv
# 通常のクリック
4,クリック,#login-button,,,ログインボタンをクリック

# 強制クリック
4,強制クリック,#login-button,,,ログインボタンを強制クリック

# スクロールしてからクリック
4,スクロール,#login-button,,,ログインボタンまでスクロール
5,クリック,#login-button,,,ログインボタンをクリック
```

### タイムアウトエラー

**症状**: 操作がタイムアウトし、以下のようなエラーメッセージが表示される
```
TimeoutException: Message: timeout: Timed out receiving message from renderer
```

**解決策**:
1. 設定ファイルのタイムアウト値を増やします
2. ネットワーク接続を確認します
3. サーバーの応答速度を確認します
4. 待機時間を増やします

**設定例**:
```toml
# タイムアウト設定
timeout = 60
retry_count = 5
```

### ブラウザがクラッシュする

**症状**: テスト実行中にブラウザがクラッシュする

**解決策**:
1. メモリ使用量を確認し、十分なメモリがあることを確認します
2. 同時に実行するセッション数を減らします
3. ブラウザのオプションを調整します

## 出力関連の問題

### スクリーンショットが保存されない

**症状**: スクリーンショットが出力ディレクトリに保存されない

**解決策**:
1. 設定ファイルの `screenshot_timing` が正しく設定されていることを確認します
2. 出力ディレクトリに書き込み権限があることを確認します
3. ディスク容量が十分にあることを確認します

**設定例**:
```toml
# スクリーンショット設定
screenshot_timing = ["before_action", "after_action", "on_error"]
```

### JSON出力が不完全

**症状**: テスト結果のJSONファイルが不完全または破損している

**解決策**:
1. テスト実行中にエラーが発生していないか確認します
2. ディスク容量が十分にあることを確認します
3. 出力ディレクトリに書き込み権限があることを確認します

## 特殊なケース

### iframeを含むページのテスト

**症状**: iframe内の要素にアクセスできない

**解決策**:
1. フレーム切替操作を追加します
2. 操作後にデフォルトフレームに戻ることを忘れないでください

**シナリオ例**:
```csv
1,URL移動,/iframe-page,,2,iFrameを含むページに移動
2,フレーム切替,#content-frame,,,コンテンツフレームに切り替え
3,テキスト入力,#frame-input,Test Content,,フレーム内の入力フィールドにテキストを入力
4,フレーム切替,default,,,デフォルトフレームに戻る
```

### 動的に生成される要素のテスト

**症状**: 動的に生成される要素が見つからない

**解決策**:
1. 要素が操作可能になるまで待機する操作を追加します
2. 待機時間を増やします
3. より安定したセレクタを使用します（IDやXPathなど）

**シナリオ例**:
```csv
1,ページ移動,/dynamic-page,,2,動的コンテンツを含むページに移動
2,要素が操作可能になるまで待機,#dynamic-content,,10,動的コンテンツが読み込まれるまで待機
3,クリック,#dynamic-button,,,動的に生成されたボタンをクリック
```

### JavaScriptを多用するSPAのテスト

**症状**: シングルページアプリケーション（SPA）でページ遷移が検出されない

**解決策**:
1. ページ移動の代わりに、JavaScript実行操作を使用します
2. URLの変更を待つのではなく、特定の要素の表示を待ちます
3. 待機時間を増やします

**シナリオ例**:
```csv
1,URL移動,/spa,,2,SPAのホームページに移動
2,クリック,#nav-dashboard,,,ダッシュボードリンクをクリック
3,待機,10,,,ダッシュボードコンテンツが表示されるまで待機
4,アサート,#dashboard-content,ダッシュボード,,ダッシュボードコンテンツの確認
```

## ログの解析

問題が発生した場合、以下のログファイルを確認することで、詳細な情報を得ることができます：

1. **concurrent_test.log**: テスト全体のログ
2. **session_*.log**: 各セッションの詳細なログ

ログファイルには、以下の情報が含まれています：

- タイムスタンプ
- ログレベル（INFO, WARNING, ERROR）
- メッセージ

例：
```
2025-03-31 06:22:57 - Session-1 - INFO - ブラウザ初期化: chrome
2025-03-31 06:22:59 - Session-1 - INFO - URLに移動: https://example.com/login
2025-03-31 06:23:01 - Session-1 - ERROR - 要素が見つかりません: #login-button
```

## サポート情報

さらに支援が必要な場合は、以下の情報を含めて問題を報告してください：

1. 使用しているオペレーティングシステムとバージョン
2. Pythonのバージョン
3. Seleniumのバージョン
4. ブラウザとWebDriverのバージョン
5. エラーメッセージとスタックトレース
6. 設定ファイルとシナリオファイル（パスワードなどの機密情報は削除してください）
7. ログファイル
## 要素をクリックできない問題

### 症状
シナリオ実行中に要素が見つかっているにもかかわらず、クリックできない場合があります。

### 原因
1. 要素が画面外にある
2. 要素が他の要素に隠れている
3. 要素がまだ完全に読み込まれていない
4. 要素がクリック可能な状態になっていない

### 解決策
1. **スクロール機能を使用する**: AiTestToolQには自動スクロール機能が実装されています。詳細は[スクロール機能](scroll_feature.md)を参照してください。
2. **強制クリックを使用する**: 通常のクリックが失敗する場合は、`強制クリック`操作を使用してみてください。
3. **待機時間を増やす**: `config.toml`ファイルの`action_delay`の値を増やしてみてください。
4. **明示的な待機を追加**: クリック前に`待機`操作を追加して、要素が完全に読み込まれるのを待ちます。
