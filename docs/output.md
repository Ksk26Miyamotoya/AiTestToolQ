# 出力とレポート

テスト実行後、結果は以下の形式で出力されます。

## 出力ディレクトリ構造

テスト実行時に生成される出力ディレクトリの構造は以下の通りです：

```
output/
└── [タイムスタンプ]/
    ├── result/
    │   ├── concurrent_test.log    # テスト全体のログ
    │   ├── test_results.json      # テスト結果のJSON
    │   ├── test_report.xlsx       # Excelレポート
    │   ├── session_1.log          # セッション1のログ
    │   └── session_2.log          # セッション2のログ
    └── screenshot/                # スクリーンショットディレクトリ
        ├── session_1/             # セッション1のスクリーンショット
        │   └── action_[id]/       # アクションごとのスクリーンショット
        │       └── [スクリーンショットファイル]
        └── session_2/             # セッション2のスクリーンショット
            └── action_[id]/       # アクションごとのスクリーンショット
                └── [スクリーンショットファイル]
```

## JSONレポート

`test_results.json`には以下の情報が含まれます：

- テスト実行時間
- テスト対象URL
- テストモード
- ユーザー数
- シナリオ情報
- 各セッションの結果
  - セッションID
  - ユーザー名
  - 成功/失敗
  - 開始/終了時間
  - 実行時間
  - スクリーンショットのリスト
  - アクション実行結果
  - エラー情報
- サマリー情報
  - 合計セッション数
  - 成功セッション数
  - 失敗セッション数
  - 合計実行時間
  - 平均実行時間

## Excelレポート

`test_report.xlsx`には以下のシートが含まれます：

1. **サマリー**: テスト全体のサマリー情報
   - レポートタイトル
   - 会社名（設定されている場合）
   - プロジェクト名（設定されている場合）
   - テスト実行日時（設定されている場合）
   - テスト対象URL
   - ユーザー数
   - 成功/失敗セッション数
   - 合計実行時間

2. **Session [ID]**: 各セッションの詳細情報
   - ユーザー名
   - 結果（成功/失敗）
   - 開始/終了時間
   - 実行時間
   - エラー情報（ある場合）
   - アクション実行結果

3. **スクリーンショット [ID]**: 各セッションのスクリーンショット
   - シナリオファイルで「Excel出力」が「yes」または「y」に設定されたアクションのスクリーンショットが表示されます

## Excelレポートのカスタマイズ

Excelレポートは以下の設定でカスタマイズできます：

```toml
# Excelレポート設定
report_title = "テスト結果報告書"        # レポートのタイトル
company_name = "株式会社テスト"          # 会社名
project_name = "テストプロジェクト"      # プロジェクト名
report_logo = "resources/template/logo.png"  # ロゴ画像のパス（空の場合は表示しない）
zoom_scale = 50                          # スクリーンショットシートの表示倍率（%）
include_timestamp = true                 # レポートにタイムスタンプを含めるか
timestamp_format = "%Y-%m-%d %H:%M:%S"   # タイムスタンプのフォーマット
```

これらの設定により、レポートの見た目や内容をカスタマイズできます。

## Excelレポートのスクリーンショット表示

シナリオファイルで「Excel出力」が「yes」または「y」に設定されたアクションのスクリーンショットは、以下のように表示されます：

1. スクリーンショットの上にアクションの説明が表示されます
2. スクリーンショットは設定された`zoom_scale`の値に基づいて縮小されて表示されます
3. 各スクリーンショットは十分なスペースを確保して配置されます

## スクリーンショット

スクリーンショットは以下のタイミングで撮影されます（設定により変更可能）：

- アクション実行前（`before_action`）
- アクション実行後（`after_action`）
- エラー発生時（`on_error`）

ファイル名の形式は以下の通りです：

```
[プレフィックス]_[アクションID]_session_[セッションID]_[タイムスタンプ].png
```

例：`before_1_session_2_20250404_144426.png`

## ログファイル

ログファイルには以下の情報が記録されます：

- テスト開始/終了時間
- URL情報
- シナリオファイル情報
- ユーザー数
- 各セッションの開始/終了
- アクション実行情報
- エラー情報
- スクリーンショット撮影情報

デバッグモードを有効にすると、より詳細なログが出力されます。
